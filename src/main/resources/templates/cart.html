<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Giỏ sách</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div th:replace="fragments/header :: header"></div>
<div class="container mt-4">
    <h2 class="mb-3">Giỏ sách của bạn</h2>
    <div id="cart-items" class="list-group">
        <div class="list-group-item d-flex justify-content-between align-items-center"
             th:each="item, iterStat : ${session.cart}" th:data-index="${iterStat.index}">
            <div>
                <span>Tên sách<h5 th:text="${item.book.title}"></h5></span>
                <p>Số lượng mua: <span class="quantity" th:text="${item.quantity}"></span></p>
            </div>
            <div>
                <!--                <p>Số lượng: </p>-->
                <button class="btn btn-sm btn-success decrease ">-</button>
                <!--                <span class="quantity" th:text="${item.quantity}"></span>-->
                <button class="btn btn-sm btn-warning increase">+</button>
                <button class="btn btn-sm btn-danger remove">Xóa</button>
            </div>
        </div>
    </div>
    <div class="mt-3">
        <button class="btn btn-primary" id="checkout">Xác nhận mượn</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const cartItems = document.querySelectorAll('#cart-items .list-group-item');

<<<<<<< HEAD
        cartItems.forEach(item => {
            const idx = item.dataset.index;
=======
        const cartItemsContainer = document.getElementById('cart-items');
        const totalQuantityEl = document.getElementById('total-quantity');

        function updateTotalQuantity() {
            let total = 0;
            document.querySelectorAll('.quantity').forEach(qty => {
                total += parseInt(qty.textContent);
            });
            totalQuantityEl.textContent = total;
        }

        function updateBackend(bookId, quantity) {
            fetch('/cart/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `bookId=${bookId}&quantity=${quantity}`
            });
        }

        function removeBackend(bookId) {
            fetch('/cart/remove', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `bookId=${bookId}`
            });
        }
        function borrowOrder() {
            fetch('/cart/checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: ``
            });
        }

        updateTotalQuantity();

        cartItemsContainer.querySelectorAll('.list-group-item').forEach(item => {

>>>>>>> 31513c7b17ddf40d8746ad8a3b230501aa5905c4
            const quantityEl = item.querySelector('.quantity');

            item.querySelector('.increase').addEventListener('click', () => {
                let q = parseInt(quantityEl.textContent);
                quantityEl.textContent = q + 1;
            });

            item.querySelector('.decrease').addEventListener('click', () => {
                let q = parseInt(quantityEl.textContent);
                if (q > 1) quantityEl.textContent = q - 1;
            });

            item.querySelector('.remove').addEventListener('click', () => {
                item.remove();
            });
        });
        document.getElementById('checkout').addEventListener('click', () => {
<<<<<<< HEAD
            alert('Đã xác nhận mượn sách! (chức năng backend sẽ xử lý)');
=======
            alert('Đã xác nhận mượn ' + totalQuantityEl.textContent + ' cuốn sách!');
            borrowOrder();
            window.location.href = '/';
>>>>>>> 31513c7b17ddf40d8746ad8a3b230501aa5905c4
        });
    });
</script>
</body>
</html>